# MSYS2 安装助手 - 卡密授权版本

## 功能说明

这是一个集成了卡密授权功能的MSYS2安装助手，用户需要通过有效的授权码验证后才能使用软件功能。

## 新增功能

### 1. 启动授权验证
- 程序启动时会显示遮罩层，要求用户进行授权验证
- 用户需要点击"开始授权验证"按钮来启动验证流程

### 2. 机器码生成
- 程序会自动生成当前机器的唯一标识码
- 机器码基于以下信息生成：
  - CPU信息
  - 主板序列号
  - 硬盘序列号
  - MAC地址

### 3. 授权验证
- 用户输入授权码后，程序会将授权码和机器码发送到服务器进行验证
- 最多允许3次验证尝试
- 验证失败3次后程序自动退出

### 4. 功能保护
- 只有通过授权验证的用户才能使用软件的核心功能
- 未授权用户无法执行任何安装步骤

## 配置文件

### auth_config.py
用于配置授权相关参数：

```python
# API服务器地址
API_BASE_URL = "http://localhost:5000"

# 验证接口路径
VALIDATE_ENDPOINT = "/api/validate"

# 最大验证尝试次数
MAX_ATTEMPTS = 3

# 超时时间（秒）
TIMEOUT = 10
```

## 使用流程

1. **启动程序**
   - 运行 `install_msys2.py`
   - 程序会申请管理员权限

2. **授权验证**
   - 程序启动后显示授权验证界面
   - 查看显示的机器码
   - 输入有效的授权码
   - 点击"验证授权"按钮

3. **开始使用**
   - 授权成功后，遮罩层消失
   - 可以正常使用所有功能

## API接口要求

授权服务器需要提供以下API接口：

### POST /api/validate

**请求格式：**
```json
{
    "code": "授权码",
    "machine_code": "机器码"
}
```

**成功响应：**
```json
{
    "status": "success",
    "message": "授权成功"
}
```

**失败响应：**
```json
{
    "status": "error",
    "message": "错误信息"
}
```

## 测试工具

### test_machine_code.py
用于测试机器码生成功能的脚本。

运行方法：
```bash
python test_machine_code.py
```

## 错误处理

1. **网络连接失败**
   - 检查API服务器地址是否正确
   - 确认网络连接正常

2. **授权码无效**
   - 检查授权码格式是否正确
   - 确认授权码是否已过期

3. **机器码不匹配**
   - 授权码已在其他机器上使用
   - 联系管理员重新分配授权码

## 部署说明

1. 确保卡密授权服务系统正常运行
2. 修改 `auth_config.py` 中的API地址
3. 分发 `install_msys2.py` 和 `auth_config.py` 给用户
4. 用户需要有效的授权码才能使用软件

## 安全特性

- 机器码基于硬件信息生成，具有唯一性
- 授权验证通过HTTPS加密传输（如果服务器支持）
- 失败次数限制防止暴力破解
- 功能级别的访问控制

## 注意事项

1. 程序需要管理员权限才能正常运行
2. 首次使用需要网络连接进行授权验证
3. 机器硬件变更可能导致机器码改变
4. 建议定期更新授权码以提高安全性
